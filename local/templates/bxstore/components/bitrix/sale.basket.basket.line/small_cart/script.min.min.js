"use strict";function BitrixSmallCart(){}BitrixSmallCart.prototype={activate:function(){this.cartElement=BX(this.cartId);this.fixedPosition=this.arParams.POSITION_FIXED=="Y";if(this.fixedPosition){this.cartClosed=true;this.maxHeight=false;this.itemRemoved=false;this.verticalPosition=this.arParams.POSITION_VERTICAL;this.horizontalPosition=this.arParams.POSITION_HORIZONTAL;this.topPanelElement=BX("bx-panel");this.fixAfterRender();this.fixAfterRenderClosure=this.closure("fixAfterRender");var c=this.closure("fixCart");this.fixCartClosure=c;if(this.topPanelElement&&this.verticalPosition=="top"){BX.addCustomEvent(window,"onTopPanelCollapse",c)}var d=null;BX.bind(window,"resize",function(){clearTimeout(d);d=setTimeout(c,200)})}this.setCartBodyClosure=this.closure("setCartBody");BX.addCustomEvent(window,"OnBasketChange",this.closure("refreshCart",{}))},fixAfterRender:function(){this.statusElement=BX(this.cartId+"status");if(this.statusElement){if(this.cartClosed){this.statusElement.innerHTML=this.openMessage}else{this.statusElement.innerHTML=this.closeMessage}}this.productsElement=BX(this.cartId+"products");this.fixCart()},closure:function(f,e){var d=this;return e?function(){d[f](e)}:function(a){d[f](a)}},toggleOpenCloseCart:function(){if(this.cartClosed){BX.removeClass(this.cartElement,"bx-closed");BX.addClass(this.cartElement,"bx-opener");this.statusElement.innerHTML=this.closeMessage;this.cartClosed=false;this.fixCart()}else{BX.addClass(this.cartElement,"bx-closed");BX.removeClass(this.cartElement,"bx-opener");BX.removeClass(this.cartElement,"bx-max-height");this.statusElement.innerHTML=this.openMessage;this.cartClosed=true;var b=this.cartElement.querySelector("[data-role='basket-item-list']");if(b){b.style.top="auto"}}setTimeout(this.fixCartClosure,100)},setVerticalCenter:function(c){var d=c/2-(this.cartElement.offsetHeight/2);if(d<5){d=5}this.cartElement.style.top=d+"px"},fixCart:function(){if(this.horizontalPosition=="hcenter"){var e="innerWidth" in window?window.innerWidth:document.documentElement.offsetWidth;var h=e/2-(this.cartElement.offsetWidth/2);if(h<5){h=5}this.cartElement.style.left=h+"px"}var g="innerHeight" in window?window.innerHeight:document.documentElement.offsetHeight;switch(this.verticalPosition){case"top":if(this.topPanelElement){this.cartElement.style.top=this.topPanelElement.offsetHeight+5+"px"}break;case"vcenter":this.setVerticalCenter(g);break}if(this.productsElement){var f=this.cartElement.querySelector("[data-role='basket-item-list']");if(this.cartClosed){if(this.maxHeight){BX.removeClass(this.cartElement,"bx-max-height");if(f){f.style.top="auto"}this.maxHeight=false}}else{if(this.maxHeight){if(this.productsElement.scrollHeight==this.productsElement.clientHeight){BX.removeClass(this.cartElement,"bx-max-height");if(f){f.style.top="auto"}this.maxHeight=false}}else{if(this.verticalPosition=="top"||this.verticalPosition=="vcenter"){if(this.cartElement.offsetTop+this.cartElement.offsetHeight>=g){BX.addClass(this.cartElement,"bx-max-height");if(f){f.style.top=82+"px"}this.maxHeight=true}}else{if(this.cartElement.offsetHeight>=g){BX.addClass(this.cartElement,"bx-max-height");if(f){f.style.top=82+"px"}this.maxHeight=true}}}}if(this.verticalPosition=="vcenter"){this.setVerticalCenter(g)}}},refreshCart:function(b){if(this.itemRemoved){this.itemRemoved=false;return}b.sessid=BX.bitrix_sessid();b.siteId=this.siteId;b.templateName=this.templateName;b.arParams=this.arParams;BX.ajax({url:this.ajaxPath,method:"POST",dataType:"html",data:b,onsuccess:this.setCartBodyClosure})},setCartBody:function(b){if(this.cartElement){this.cartElement.innerHTML=b.replace(/#CURRENT_URL#/g,this.currentUrl)}if(this.fixedPosition){setTimeout(this.fixAfterRenderClosure,100)}},removeItemFromCart:function(b){this.refreshCart({sbblRemoveItemFromCart:b});this.itemRemoved=true;BX.onCustomEvent("OnBasketChange")}};